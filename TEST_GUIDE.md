# Mr.π Capture - 测试指南

> 本文档提供详细的测试步骤，确保扩展的所有功能正常工作

**测试日期**：2025-11-09
**测试版本**：v1.0.0
**测试环境**：Chrome 88+

---

## 📋 测试前准备

### 1. 加载扩展到Chrome

```bash
# 步骤：
1. 打开 Chrome 浏览器
2. 访问 chrome://extensions/
3. 开启右上角的「开发者模式」
4. 点击「加载已解压的扩展程序」
5. 选择项目根目录：/Users/robin/project/mrpi-capture-extension
6. 确认扩展图标出现在工具栏
```

### 2. 准备测试环境

- [ ] 确认网络连接正常
- [ ] 准备一个有效的API Token（从Mr.π AI Studio后台获取）
- [ ] 准备测试网页（建议使用 https://www.example.com）

### 3. 清空之前的配置（可选）

```bash
# 如果需要测试首次安装场景，先清空storage：
1. 在 chrome://extensions/ 找到扩展
2. 点击「详细信息」
3. 点击「清除存储空间」
4. 或者在开发者工具Console中执行：
   chrome.storage.sync.clear()
```

---

## 🧪 测试场景1：首次使用流程

### 目标
验证用户首次安装扩展后的引导体验

### 前置条件
- 扩展已加载
- API Token **未配置**（首次安装或已清空storage）

### 测试步骤

#### 1.1 点击扩展图标显示popup
**操作**：点击Chrome工具栏中的扩展图标
**预期结果**：
- ✅ Popup窗口正常打开
- ✅ 窗口尺寸约为 380x400px
- ✅ 显示标题"🎯 Mr.π Capture"

**实际结果**：□ 通过 / □ 失败
**备注**：

---

#### 1.2 显示"未配置API Token"提示
**操作**：观察popup顶部消息区域
**预期结果**：
- ✅ 顶部显示蓝色信息提示框
- ✅ 提示内容：「👋 首次使用？请先点击下方"⚙️ 配置 API Token"进行设置」
- ✅ 提示框背景色为浅蓝色（#dbeafe）
- ✅ 提示持续显示（不自动消失）

**实际结果**：□ 通过 / □ 失败
**备注**：

**开发者控制台检查**（右键popup → 检查 → Console）：
```
预期日志：
- "Loaded tab info: {url: ..., title: ...}"
- "API Token not configured"
```

---

#### 1.3 点击"⚙️ 配置 API Token"跳转
**操作**：点击popup底部的「⚙️ 配置 API Token」链接
**预期结果**：
- ✅ 打开新标签页显示options页面
- ✅ 页面标题为"Mr.π Capture - 设置"
- ✅ 显示API Token输入框（密码类型，内容隐藏）

**实际结果**：□ 通过 / □ 失败
**备注**：

---

#### 1.4 成功保存token
**操作**：
1. 在API Token输入框中输入测试token（例如：`test-token-1234567890`）
2. 点击「👁️」按钮验证输入内容可见
3. 再次点击「🙈」按钮隐藏内容
4. 点击「💾 保存设置」按钮

**预期结果**：
- ✅ 显示/隐藏按钮正常工作
- ✅ 点击保存后按钮文字变为"保存中..."
- ✅ 按钮被禁用（不可点击）
- ✅ 显示绿色成功提示：「保存成功 ✔」
- ✅ 1.5秒后按钮恢复为「💾 保存设置」
- ✅ 成功提示3秒后自动消失

**实际结果**：□ 通过 / □ 失败
**备注**：

**开发者控制台检查**（右键options页面 → 检查 → Console）：
```
预期日志：
- "API Token saved successfully"
```

---

#### 1.5 验证token已保存
**操作**：
1. 刷新options页面（F5）
2. 观察API Token输入框

**预期结果**：
- ✅ 输入框中自动填充了之前保存的token（以密码形式显示）
- ✅ 点击「👁️」可查看完整token内容

**实际结果**：□ 通过 / □ 失败
**备注**：

---

## 🧪 测试场景2：完整信息捕获流程

### 目标
验证用户保存网页信息的完整流程

### 前置条件
- 扩展已加载
- API Token **已配置**

### 测试步骤

#### 2.1 打开测试网页
**操作**：在Chrome中访问 https://www.example.com
**预期结果**：
- ✅ 网页正常加载
- ✅ 页面标题显示为"Example Domain"

**实际结果**：□ 通过 / □ 失败
**备注**：

---

#### 2.2 点击扩展图标
**操作**：点击Chrome工具栏中的扩展图标
**预期结果**：
- ✅ Popup窗口正常打开
- ✅ **不显示**"未配置API Token"的提示（因为已配置）

**实际结果**：□ 通过 / □ 失败
**备注**：

**开发者控制台检查**：
```
预期日志：
- "Loaded tab info: {url: 'https://www.example.com/', title: 'Example Domain'}"
- "API Token is configured"
```

---

#### 2.3 验证URL和标题自动填充
**操作**：观察表单字段
**预期结果**：
- ✅ "页面地址"字段自动填充：`https://www.example.com/`
- ✅ "页面标题"字段自动填充：`Example Domain`
- ✅ 页面地址字段为只读（灰色背景，无法编辑）
- ✅ 页面标题字段可编辑（白色背景）

**实际结果**：□ 通过 / □ 失败
**备注**：

---

#### 2.4 编辑标题
**操作**：
1. 点击"页面标题"输入框
2. 修改为：`Example Domain - 测试页面`

**预期结果**：
- ✅ 标题可以正常编辑
- ✅ 输入框获得焦点时显示蓝色边框

**实际结果**：□ 通过 / □ 失败
**备注**：

---

#### 2.5 输入备注
**操作**：
1. 点击"备注说明"文本框
2. 输入：`这是一个测试网页，用于验证扩展的保存功能。`

**预期结果**：
- ✅ 备注可以正常输入
- ✅ 文本框支持多行输入
- ✅ 获得焦点时显示蓝色边框

**实际结果**：□ 通过 / □ 失败
**备注**：

---

#### 2.6 选择分类标签
**操作**：
1. 点击"分类标签"下拉框
2. 选择「Product (产品)」

**预期结果**：
- ✅ 下拉框显示5个选项：
  - `-- 请选择标签 --`（默认，空值）
  - `Product (产品)`
  - `Competitor (竞品)`
  - `Content (内容)`
  - `Inspiration (灵感)`
- ✅ 选中后下拉框显示「Product (产品)」

**实际结果**：□ 通过 / □ 失败
**备注**：

---

#### 2.7 点击"保存到Mr.π"
**操作**：点击紫色的「💾 保存到 Mr.π」按钮

**⚠️ 重要说明**：
此步骤需要后端API正常运行！如果后端未启动，会出现网络错误（这是正常的）。

**预期结果（API可用时）**：
- ✅ 按钮文字变为"保存中..."
- ✅ 按钮被禁用
- ✅ 发送POST请求到 `https://api.mrpi.ai/api/captured-items`
- ✅ 请求头包含：
  ```
  Content-Type: application/json
  Authorization: Bearer <YOUR_TOKEN>
  ```
- ✅ 请求体包含：
  ```json
  {
    "url": "https://www.example.com/",
    "title": "Example Domain - 测试页面",
    "note": "这是一个测试网页，用于验证扩展的保存功能。",
    "tags": ["Product"],
    "source": "chrome_extension"
  }
  ```

**预期结果（API不可用时）**：
- ✅ 显示红色错误提示：「无法连接到服务器，请检查网络」
- ✅ 按钮恢复为「💾 保存到 Mr.π」并可点击

**实际结果**：□ 通过 / □ 失败
**备注**：

**开发者控制台检查（Network标签）**：
```
查看请求详情：
- URL: https://api.mrpi.ai/api/captured-items
- Method: POST
- Headers: 查看Authorization和Content-Type
- Payload: 查看发送的JSON数据
```

---

#### 2.8 验证成功提示显示（仅API可用时）
**操作**：观察API返回200成功后的UI变化
**预期结果**：
- ✅ 显示绿色成功提示：「保存成功 ✔」
- ✅ 提示框背景色为浅绿色（#d1fae5）

**实际结果**：□ 通过 / □ 失败
**备注**：

**开发者控制台检查**：
```
预期日志：
- "Save success: {返回的数据对象}"
```

---

#### 2.9 验证1.5秒后popup自动关闭（仅API可用时）
**操作**：保持popup打开，不进行任何操作
**预期结果**：
- ✅ 成功提示显示后约1.5秒，popup窗口自动关闭

**实际结果**：□ 通过 / □ 失败
**备注**：

---

## 🔍 额外验证测试

### 3.1 表单验证测试

#### 测试3.1.1：标题为空
**操作**：
1. 打开popup
2. 清空"页面标题"字段
3. 选择标签
4. 点击保存

**预期结果**：
- ✅ 显示红色错误提示：「请填写所有必填项」
- ✅ 不发送API请求
- ✅ 按钮保持可用

**实际结果**：□ 通过 / □ 失败

---

#### 测试3.1.2：未选择标签
**操作**：
1. 打开popup
2. 保持标题有值
3. 不选择标签（保持"-- 请选择标签 --"）
4. 点击保存

**预期结果**：
- ✅ 显示红色错误提示：「请填写所有必填项」
- ✅ 不发送API请求

**实际结果**：□ 通过 / □ 失败

---

### 3.2 Token验证测试

#### 测试3.2.1：Token长度过短
**操作**：
1. 打开options页面
2. 输入短token：`abc`
3. 点击保存

**预期结果**：
- ✅ 显示红色错误提示：「API Token 格式不正确，长度过短」
- ✅ 不保存到storage

**实际结果**：□ 通过 / □ 失败

---

### 3.3 UI交互测试

#### 测试3.3.1：焦点样式
**操作**：依次点击每个输入框
**预期结果**：
- ✅ 获得焦点时显示蓝色边框
- ✅ 显示淡蓝色阴影（box-shadow）

**实际结果**：□ 通过 / □ 失败

---

#### 测试3.3.2：按钮悬停效果
**操作**：鼠标悬停在「💾 保存到 Mr.π」按钮上
**预期结果**：
- ✅ 按钮轻微上移（transform: translateY(-1px)）
- ✅ 阴影加深

**实际结果**：□ 通过 / □ 失败

---

## 📊 测试总结模板

### 测试环境
- **测试日期**：
- **Chrome版本**：
- **操作系统**：
- **扩展版本**：v1.0.0

### 测试结果汇总
- **场景1 - 首次使用流程**：
  - 1.1 显示popup: □ 通过 / □ 失败
  - 1.2 显示token提示: □ 通过 / □ 失败
  - 1.3 跳转options: □ 通过 / □ 失败
  - 1.4 保存token: □ 通过 / □ 失败
  - 1.5 验证token: □ 通过 / □ 失败

- **场景2 - 完整捕获流程**：
  - 2.1 打开测试网页: □ 通过 / □ 失败
  - 2.2 点击图标: □ 通过 / □ 失败
  - 2.3 自动填充: □ 通过 / □ 失败
  - 2.4 编辑标题: □ 通过 / □ 失败
  - 2.5 输入备注: □ 通过 / □ 失败
  - 2.6 选择标签: □ 通过 / □ 失败
  - 2.7 点击保存: □ 通过 / □ 失败
  - 2.8 成功提示: □ 通过 / □ 失败 / □ N/A（后端未运行）
  - 2.9 自动关闭: □ 通过 / □ 失败 / □ N/A（后端未运行）

- **场景3 - 额外验证**：
  - 3.1.1 标题为空: □ 通过 / □ 失败
  - 3.1.2 未选标签: □ 通过 / □ 失败
  - 3.2.1 Token过短: □ 通过 / □ 失败
  - 3.3.1 焦点样式: □ 通过 / □ 失败
  - 3.3.2 按钮悬停: □ 通过 / □ 失败

### 发现的问题
1.
2.
3.

### 改进建议
1.
2.
3.

### 测试结论
□ **通过 - 可以发布MVP**
□ **部分通过 - 需要修复问题后再测试**
□ **失败 - 需要重大修改**

---

**测试完成日期**：
**测试人员签名**：
