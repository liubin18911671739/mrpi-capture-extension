# 🚀 快速测试指南

Mock API服务器已启动！现在可以完整测试扩展的所有功能了。

---

## ✅ 当前状态

- ✅ Mock API服务器运行中：`http://localhost:3000`
- ✅ 扩展已配置使用本地API
- ✅ CORS已配置（允许Chrome扩展访问）

---

## 📝 测试步骤（约5分钟）

### 第1步：重新加载扩展

由于修改了`manifest.json`和`popup.js`，需要重新加载扩展：

```bash
1. 打开 Chrome 浏览器
2. 访问 chrome://extensions/
3. 找到 "Mr.π Capture" 扩展
4. 点击刷新图标 🔄（或点击"重新加载"）
```

**重要**：每次修改代码后都需要重新加载扩展！

---

### 第2步：配置API Token

```bash
1. 点击扩展图标（工具栏中的Mr.π图标）
2. 你应该会看到蓝色提示：
   "👋 首次使用？请先点击下方"⚙️ 配置 API Token"进行设置"
3. 点击底部的"⚙️ 配置 API Token"链接
4. 输入任意token（例如：test-token-12345678）
   Mock服务器会接受任何token，只要长度>10
5. 点击"💾 保存设置"
6. 看到绿色成功提示："保存成功 ✔"
```

**测试点**：
- ✅ 蓝色提示是否正确显示？
- ✅ 跳转到options页面是否正常？
- ✅ Token保存是否成功？

---

### 第3步：测试完整捕获流程

```bash
1. 打开任意网页（建议使用 https://www.example.com）
2. 点击扩展图标
3. 观察表单：
   - URL应该自动填充：https://www.example.com/
   - 标题应该自动填充：Example Domain
   - 不应该再显示蓝色token提示（因为已配置）
4. 修改标题为："Example Domain - 测试页面"
5. 在备注框输入："这是一个测试，验证Mock API是否正常工作"
6. 选择标签："Product (产品)"
7. 点击"💾 保存到 Mr.π"
```

**预期结果**：
- ✅ 按钮变为"保存中..."
- ✅ 显示绿色成功提示："保存成功 ✔"
- ✅ 1.5秒后popup自动关闭
- ✅ **在运行Mock服务器的终端窗口，你会看到详细的接收数据日志！**

---

### 第4步：查看Mock服务器输出

在运行`node mock-api-server.js`的终端窗口中，你应该看到类似输出：

```
✅ 接收到新的捕获数据:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📌 ID:      1
🔗 URL:     https://www.example.com/
📝 标题:    Example Domain - 测试页面
💬 备注:    这是一个测试，验证Mock API是否正常工作
🏷️  标签:    Product
📱 来源:    chrome_extension
⏰ 时间:    2025-11-09T12:40:50.123Z
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**这证明扩展成功发送了数据！** 🎉

---

## 🧪 额外测试（可选）

### 测试1：表单验证

1. 打开扩展popup
2. 清空标题字段
3. 点击保存
4. **预期**：显示红色错误"请填写所有必填项"

### 测试2：多次保存

1. 保存3-5个不同的网页
2. 每次都检查Mock服务器输出
3. **预期**：ID递增（1, 2, 3, ...）

### 测试3：查看所有保存的数据

在浏览器中访问：`http://localhost:3000/api/captured-items`

**预期**：看到JSON格式的所有已保存数据

---

## 🐛 故障排查

### 问题1：保存时提示"无法连接到服务器"

**原因**：Mock服务器未运行或已停止

**解决**：
```bash
# 检查服务器是否运行
curl http://localhost:3000/health

# 如果失败，重新启动服务器
node mock-api-server.js
```

### 问题2：保存后没有任何反应

**原因**：扩展未重新加载

**解决**：
1. 访问 `chrome://extensions/`
2. 找到扩展，点击刷新图标 🔄

### 问题3：Mock服务器输出为空

**原因**：可能是API地址配置错误

**检查**：
1. 打开扩展popup
2. 右键 → 检查 → Console标签
3. 查看是否有错误信息

---

## 📊 测试完成检查清单

完成以下测试项后，可以认为扩展功能正常：

- [ ] 首次使用时显示蓝色token提示
- [ ] 成功配置并保存API Token
- [ ] URL和标题自动填充
- [ ] 可以编辑标题
- [ ] 可以输入备注
- [ ] 可以选择标签
- [ ] 点击保存后显示"保存中..."
- [ ] 保存成功后显示绿色提示
- [ ] 1.5秒后popup自动关闭
- [ ] Mock服务器终端显示接收到的数据
- [ ] 表单验证正常工作（空字段会报错）

---

## 🔄 测试完成后

### 选项1：继续使用Mock API
保持服务器运行，可以继续测试

### 选项2：停止Mock服务器
在服务器终端按 `Ctrl+C` 停止

### 选项3：切换到生产API（未来）
编辑 `popup.js`，修改：
```javascript
BASE_URL: 'http://localhost:3000',  // ← 改为
BASE_URL: 'https://api.mrpi.ai',    // ← 生产地址
```

---

## 📝 记录测试结果

请在 `TODO.md` 中记录测试结果：

```markdown
### 测试日期：2025-11-09
### 测试环境：
- Chrome版本：
- 操作系统：macOS
- Mock API：✅ 运行正常

### 测试结果：
- ✅ 首次使用流程通过
- ✅ 完整捕获流程通过
- ✅ 表单验证通过
- ✅ Mock API接收数据正常

### 发现的问题：
（如果有）

### 下一步：
- 准备发布到生产环境
```

---

**祝测试顺利！** 🎉

有任何问题，请检查：
1. Mock服务器是否运行（查看终端输出）
2. 扩展是否已重新加载（chrome://extensions/）
3. Chrome开发者工具Console是否有错误
